# 类linux驱动模块框架module_init(init_fun)在STM32上的实现

## 试验环境
* 工具链：Keil5
* 开发板STM32F103ZE

-----------------------------------------------

## 1. 修改链接脚本

修改链接脚本的目的是：在STM32的内存中，留出一块合适的大小(大小根据自己的需求调整)，
用来存放各个模块的初始化函数

### 1.1 内存分配

在Keil中新建一个工程，其链接脚本如下：

```
; *************************************************************
; *** Scatter-Loading Description File generated by uVision ***
; *************************************************************

LR_IROM1 0x08000000 0x00080000  {    ; load region size_region
  ER_IROM1 0x08000000 0x00080000  {  ; load address = execution address
   *.o (RESET, +First)
   *(InRoot$$Sections)
   .ANY (+RO)
   .ANY (+XO)
  }
  
  ; 此区域(RW_IRAM1)使用所有的内存64Kb
  RW_IRAM1 0x20000000 0x00010000  {  ; RW data
   .ANY (+RW +ZI)
  }
}



```

我们将其修改：RW_IRAM1为48K，RW_IRAM2为16K，其中RW_IRAM2用来顺序存放各模块的初始化函数

```

; *************************************************************
; *** Scatter-Loading Description File generated by uVision ***
; *************************************************************

LR_IROM1 0x08000000 0x00080000  {    ; load region size_region
  ER_IROM1 0x08000000 0x00080000  {  ; load address = execution address
   *.o (RESET, +First)
   *(InRoot$$Sections)
   .ANY (+RO)
   .ANY (+XO)
  }
  
  ;RW_IRAM1为48K，供应用程序使用
  RW_IRAM1 0x20000000 0x0000c000  {  ; RW data
   .ANY (+RW +ZI)
  }
  
  ;RW_IRAM2为16K，用于存放各个模块的初始化函数
  RW_IRAM2 0x2000c000 0x00004000  {  ; RW data
   *.o(RAMCODE)
  }
}

```

### 1.2 

